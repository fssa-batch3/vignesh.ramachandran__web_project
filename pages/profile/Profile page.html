<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&
    family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700&display=swap"
            rel="stylesheet">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link
            href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&family=Kurale&display=swap"
            rel="stylesheet">

        <link rel="stylesheet" href="https://unpkg.com/boxicons@latest/css/boxicons.min.css">

        <link rel="stylesheet" href="../../assets/css/header.css">
        <link rel="stylesheet" href="../../assets/css/Profile-CSS/profile page.css">

        <link rel="stylesheet" href="../../assets/css/normalize.css">

        <link rel="icon" href="../../assets/img/main-logo.png">
        <title>Profile</title>
    </head>

    <body>

        <!-- main starts -->
        <main>
            <!-- profile starts -->
            <section class="profile">

                <form role="form" onsubmit="save(event)">
                    <div class="top">
                        <h2 class="heading">
                            <span>My</span> Profile
                        </h2>
                        <!-- <button class="delete btn" type="button" onclick="deleteAcc()">Delete Account</button> -->
                    </div>

                    <div class="profile_form">

                        <div class="profile_photo">
                            <img class="sr" src="../../assets/img/sr.jpg" alt="profile image">
                        </div>

                        <div class="details">
                            <label for="name">Name:</label>
                            <input type="text" name="name" id="name" pattern="[A-Za-z.]+"
                                title="Enter alphabet without space" required="true" readonly>
                            <label for="email">Email:</label>
                            <input type="email" name="email" id="email" disabled>
                            <label for="number">Phone Number:</label>
                            <input type="number" name="phone no." id="phone_number" disabled>
                            <label for="password">Password:</label>
                            <input type="password" name="password" id="password"
                                pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
                                title="Must contain at least one number, one uppercase, lowercase and one symbol, and at least 8 or more characters"
                                required="true" readonly>
                            <div id="pattern">
                                <span class="number_pass">Must contain at least one number,</span>
                                <span class="upper_pass">one uppercase,</span>
                                <span class="lower_pass">one lowercase,</span>
                                <span class="symbol_pass">one symbol,</span>
                                <span class="char_pass">and at least 8 or more characters</span>
                            </div>
                            <div class="show_password">
                                <input type="checkbox" id="show">
                                <label>Show password</label>
                            </div>
                        </div>

                    </div>

                    <div class="btn_content">
                        <button type="button" class="edit btn">
                            <img src="../../assets/img/edit.jpg" alt="edit button">
                            <p>Edit profile</p>
                        </button>
                        <button type="submit" class="save btn" style="display:none;">Save</button>
                        <a href="../../index.html">
                            <button class="btn back" type="button">Back</button>
                        </a>
                        <!-- </a> -->
                    </div>
                    <div class="logout_button">
                        <a href="../../index.html">
                            <button class="logout btn" type="button" id="logout">Log out</button>
                        </a>

                    </div>
                </form>
            </section>
            <!-- profile ends -->
        </main>
        <!-- main ends -->

        <!-- footer starts -->

        <footer>
            <div class="footer-details">
                <p>
                    Copyright Â© 2021 - 2023 SR Catering - Website Designed By <span>vicky</span>
                </p>
                <p>(+91)6379370482</p>
                <div class="footer-links">
                    <a href="https://www.instagram.com/vicky_sk_forever?r=nametag">
                        <img
                            src="../../assets/img/instagram.jpg" alt="instagram"> </a>
                    <a href="https://www.facebook.com/profile.php?id=100011341742455">
                        <img
                            src="../../assets/img/facebook.jpg" alt="facebook link"> </a>
                    <a href="https://twitter.com/SRVignesh06?t=zGFf0sZZJa_0oe8XfsLkOQ&s=08">
                        <img
                            src="../../assets/img/twitter.png" alt="twitter link"> </a>
                </div>
            </div>
        </footer>

        <!-- footer ends -->

        <!-- script starts -->
        <script src="../../assets/JS/header.js"></script>

        <script>// islogged out
        window.addEventListener("popstate", function (event) {
  if (!isloggedin()) {
            event.preventDefault();
            window.location.href = `${root}/pages/profile/Login.html`;
  }
        });

        function isloggedin() {
  // const user_id = JSON.parse(localStorage.getItem("user_unique"))
  if (user_id) {
            return true;
  }

  return false;
}

        if (!isloggedin()) {
          window.location.href = `${root}/pages/profile/Login.html`;
        }
        
        const Password = document.querySelector("#password");
        const Checkbox = document.querySelector("#show");

        Checkbox.addEventListener("click", function () {
          const type =
    Password.getAttribute("type") === "password" ? "text" : "password";
          Password.setAttribute("type", type);
        });

        //get value from local storage
        const user_unique = JSON.parse(localStorage.getItem("user_unique"));
        // let unique_id = unique_id_1["email"]
        const userData = JSON.parse(localStorage.getItem("userData"));

        function profile_data(e) {
          return e.email == user_unique;
        }

        // finding the userData which unique_id correctly matches
        person_data = userData.find(profile_data);

        // inserting the data (values) to the correct place in the profile
        document.getElementById("name").value = person_data.name;
        document.getElementById("email").value = person_data.email;
        document.getElementById("phone_number").value = person_data.phone_number;
        document.getElementById("password").value = person_data.password;

        // delete account function

        // function deleteAcc() {
        //     if (confirm("Are you sure to delete this account ?")) {

        //         //get value from local storage
        //         let user_unique = JSON.parse(localStorage.getItem("user_unique"));
        //         // let unique_id = unique_id_1["email"]
        //         let userData = JSON.parse(localStorage.getItem("userData"));

        //         function profile_data(e) {
        //             return e.email == user_unique;
        //         }

        //         // finding the userData which user_unique correctly matches
        //         let person_data = userData.find(profile_data);

        //         // find the index of person_data from userData
        //         let result = userData.indexOf(person_data);

        //         // deleting the indexof person data
        //         userData.splice(result, 1);

        //         alert("Your Account was deleted")
        //         localStorage.setItem("userData", JSON.stringify(userData));

        //         window.location.href = "../../index.html";
        //     }
        // }

        // logout function
        // function logOut() {
        //     if (confirm("Are you going to Logout ?")) {

        //         // deleting the unique_id of person data
        //         localStorage.setItem("user_id", "");
        //         window.location.href = "../../index.html";
        //     }
        // }

        function update(e) {
          // getting the updated data from the input field
          const up_name = document.getElementById("name").value;
          const up_password = document.getElementById("password").value;
          // paste the updated data to the correct object
          person_data.name = up_name;
          person_data.password = up_password;
          // again paste it to the
          localStorage.setItem("userData", JSON.stringify(userData));
        }

        // edit button
        const edit = document.querySelector(".edit");
        edit.addEventListener("click", findReadonly);

        // save button
        // const save = document.querySelector(".save");

        // save.addEventListener("click", update)
        // save.addEventListener("click", findReadonly1)
        const save = (e) => {
          update();
          findReadonly1();

          e.preventDefault();
        };

        function findReadonly(e) {
          document.getElementById("name").removeAttribute("readonly");
          document.getElementById("password").removeAttribute("readonly");
          document.querySelector(".save").removeAttribute("style");
          document.querySelector(".edit").setAttribute("style", "display:none");
          const head = document.querySelector(".heading");
          head.innerHTML = "<span>My</span> Profile-Edit";
          document.querySelector("#pattern").setAttribute("style", "display:block");
        }

        function findReadonly1(e) {
          document.getElementById("name").setAttribute("readonly", "true");
          document.getElementById("password").setAttribute("readonly", "true");
          document.querySelector(".save").setAttribute("style", "display:none");
          document.querySelector(".edit").setAttribute("style", "display:flex");
          document.querySelector("#pattern").removeAttribute("style");
        }

        // password pattern recognization
        const password = document.getElementById("password");

        const number_pass = document.querySelector(".number_pass");
        const upper_pass = document.querySelector(".upper_pass");
        const lower_pass = document.querySelector(".lower_pass");
        const symbol_pass = document.querySelector(".symbol_pass");
        const char_pass = document.querySelector(".char_pass");

        password.addEventListener("input", () => {
          const password_value = password.value;

          // check upper case
          const has_upper = /[A-Z]/.test(password_value);
          if (has_upper == true) {
            upper_pass.style.color = "green";
          } else {
            upper_pass.style.color = "var(--second-color)";
          }

          // check lower case
          const has_lower = /[a-z]/.test(password_value);
          if (has_lower == true) {
            lower_pass.style.color = "green";
          } else {
            lower_pass.style.color = "var(--second-color)";
          }

          // check number
          const has_symbol = /[!@#$%^&*_=+-]/.test(password_value);
          if (has_symbol == true) {
            symbol_pass.style.color = "green";
          } else {
            symbol_pass.style.color = "var(--second-color)";
          }

          // check char
          const has_number = /\d/.test(password_value);
          if (has_number == true) {
            number_pass.style.color = "green";
          } else {
            number_pass.style.color = "var(--second-color)";
          }

          // check length
          const char_length = password_value.length >= 8;
          if (char_length == true) {
            char_pass.style.color = "green";
          } else {
            char_pass.style.color = "var(--second-color)";
          }
        });
    </script>
        <!-- script ends -->

    </body>

</html>