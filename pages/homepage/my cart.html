<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&
    family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700&display=swap"
        rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&family=Kurale&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="https://unpkg.com/boxicons@latest/css/boxicons.min.css">

    <script src="../library/moment.js"></script>

    <link rel="stylesheet" href="../../assets/css/header.css">
    <link rel="stylesheet" href="../../assets/css/my cart.css">

    <link rel="stylesheet" href="../../assets/css/normalize.css">

    <link rel="icon" href="../../assets/img/main-logo.png">
    <title>My cart</title>
</head>

<body>
    <!-- header starts -->
    <!-- <header>
        <div class="bx bx-menu" id="toggle" onclick="openNav()"></div>

        <div class="icon-left">
            <img src="../../assets/img/main-logo.png" alt="Company Logo" class="logo" />
            <h1>SR</h1>
            <div>
                <p>Catering</p>
            </div>
        </div>

        <ul class="navigation" id="sidenav">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>

            <li><a href="../../index.html" class="navigation-link">HOME</a></li>
            <li class="dropdown">
                <span class="navigation-link">MENU</span>
                <div class="dropdown-content">
                    <div>
                        <a href="../products/Menus/menu-morning.html">Breakfast Menu</a>
                        <a href="../products/Menus/menu-lunch.html">Lunch Menu</a>
                        <a href="../products/Menus/menu-hightea.html">Hightea Menu</a>
                        <a href="../products/Menus/menu-dinner.html">Dinner Menu</a>
                        <a href="../products/Menus/menu-custom.html">Custom Menu</a>
                    </div>
                </div>
            </li>
            <li><a href="./Events/events.html" class="navigation-link">EVENTS</a></li>
            <li><a href="./about us.html" class="navigation-link">ABOUT US</a></li>
            <li><a href="./contact us.html" class="navigation-link">CONTACT US</a></li>
            <li><a href="./my cart.html" class="navigation-link">MY CART</a></li>
        </ul>

        <div class="dropdown_profile">
            <img src="../../assets/img/profile.png" alt="profile image" />
            <div class="dropdown_profile-content">
                <div>
                    <a href="../profile/Profile page.html">My Profile</a>
                    <a href="../profile/register.html">Register</a>
                    <a href="../profile/Login.html">Log in</a>
                    <a href="../profile/my orders.html">My Orders</a>
                </div>
            </div>
        </div>
    </header> -->
    <!-- header ends -->

    <!-- main starts -->

    <main>
        <div class="ingredient-image">
            <h2>My Cart</h2>
        </div>
        <!-- my cart details starts -->
        <section class="section">
            <div class="cart">
                <!-- <div class="cart_content">
                <div class="cart_text">
                    <h2>Breakfast</h2>
                    <label>Date:<input type="date" class="date" required="true"/></label>
                    <label>No.Of.Guest:<input type="number" class="number" required="true"/></label>
                </div>
                <div class="change">
                    <div class="cart_end">
                        <img src="../../assets/img/Dishes/ordinary tiffin.jpg" alt="ordinary tiffin" />
                        <p class="price">₹150</p>
                        <div class="btn_cart">
                            <a href="../profile/Order page.html" ><button type="button" class="btn order">ORDER</button></a>
                            <a href="#"><button type="button" class="btn remove">Remove</button></a>
                        </div>
                    </div>
                    <div class="cart_dishes">
                        <h3><span>SR</span>'s Ordinary Breakfast</h3>
                        <ul class="dishes">
                            <li>  KUSHBOO IDLY</li>
                            <li>  KITCHADI</li>
                            <li>  VADA</li>
                            <li>  POORI - VEG GRAVY</li>
                            <li>  IDIYAPPAM (OR) MINI UTTAPPAM</li>
                            <li>  MINI LADDU</li>
                            <li>  SAMBAR</li>
                            <li>  COCONUT CHUTNY</li>
                            <li>  HOT MILK & COFFEE</li>
                            <li>  MINERAL WATER</li>
                            <li>  BANANA LEAF</li>
                        </ul>
                    </div>
                </div>
            </div> -->
            </div>
            <div class="summary">
                <div class="sum_content">
                    <h2><span> ORDER</span> SUMMARY</h2>
                    <div class="sum_name">
                        <h3>Menu Nam<span>e</span></h3>
                        <h3>Dat<span>e</span></h3>
                        <h3>Pric<span>e</span></h3>
                    </div>
                    <!-- <div class="sum_details">
                        <p>Ordinary Breakfast</p>
                        <p>14-04-2023</p>
                        <p>250</p>
                    </div>
                  
                    <div class="sum_end">
                        <p>Total Price</p>
                        <p>250</p>
                    </div> -->
                </div>

                <div class="cart_orderall">
                    <!-- <a href="../profile/Order page.html"> -->
                    <!-- <button type="button" class="btn orderall">ORDER ALL (2)</button> -->
                    <!-- </a> -->
                </div>

            </div>

        </section>

        <!-- <section class="cart_ord-tif">
            <div class="cart_ord-tif-content">
                <div class="cart_ord-tif-text">
                    <h2>Lunch</h2>
                    <label>Date:<input type="date" class="date" required="true"/></label>
                    <label>No.Of.Guest:<input type="number" class="number" required="true"/></label>
                </div>
                <div class="change">
                    <div class="cart_ord-tif-end">
                        <img src="../../assets/img/Dishes/special lunch.jpg" alt="special lunch" />
                        <p class="price">₹250</p>
                        <div class="btn_cart">
                            <a href="../profile/Order page.html" ><button type="button" class="btn order">ORDER</button></a>
                            <a href="#"><button type="button" class="btn remove">Remove</button></a>
                        </div>
                    </div>
                    <div class="cart_dishes">
                        <h3><span>SR</span>'s Special Lunch</h3>
                        <ul class="dishes">
                            <li>  MINI JANGRI (OR) LADDU</li>
                            <li>  BOILED RICE</li>
                            <li>  MIXED VEG SAMBAR</li>
                            <li>  VATTAL KUZHAMBU</li>
                            <li>  RASAM</li>
                            <li>  CHAPPATI - VEG GRAVY</li>
                            <li>  PROIYAL</li>
                            <li>  VARUVAL</li>
                            <li>  PAPPAD (OR) CHIPS</li>
                            <li>  ONION VADA</li>
                            <li>  BUTTER MILK</li>
                            <li>  PICKLE</li>
                            <li>  VEG SALAD</li>
                            <li>  MINERAL WATER</li>
                            <li>  BANANA LEAF</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section> -->

        <!-- my cart details ends -->
    </main>
    <!-- main ends -->

    <!-- footer starts -->

    <!-- <footer>
        <div class="footer-box">
            <div class="footer-content">
                <img src="../../assets/img/main-logo.png" alt="Company Logo" />
                <p>
                    SR Catering service is a professional catering service provider located in Kumbakonam, catering both
                    personal and corporate orders.
                </p>
            </div>

        </div>
        <div class="footer-details">
            <p>Copyright © 2021 - 2023 SR Catering - Website Designed By <span>vicky</span></p>
            <p>(+91)6379370482</p>
            <div class="footer-links">
                <a href="https://www.instagram.com/vicky_sk_forever?r=nametag"> <img
                        src="../../assets/img/instagram.jpg" alt="instagram" /> </a>
                <a href="https://www.facebook.com/profile.php?id=100011341742455"> <img
                        src="../../assets/img/facebook.jpg" alt="facebook link" /> </a>
                <a href="https://twitter.com/SRVignesh06?t=zGFf0sZZJa_0oe8XfsLkOQ&s=08"> <img
                        src="../../assets/img/twitter.png" alt="twitter link" /> </a>
            </div>
        </div>

    </footer> -->
    <!-- footer ends -->

    <!-- script starts -->
    <script src="../../assets/JS/header.js"></script>

    <script>



        cartData = JSON.parse(localStorage.getItem("cartData"));
        // menuData = JSON.parse(localStorage.getItem("menuData"));
        categoryData = JSON.parse(localStorage.getItem("categoryData"));
        dishData = JSON.parse(localStorage.getItem("dishData"));
        user_unique = JSON.parse(localStorage.getItem("user_unique"));

        console.log(user_unique)

        console.log(cartData)

        let cartData_user = cartData.filter(data =>
            data.user_id == user_unique)

        // console.log(cartData_user)

        let m = moment().format("YYYY-MM-DD");

        for (let i = 0; i < cartData_user.length; i++) {

            let menuId = cartData_user[i]["menu_id"];

            // for getting menu name from url
            let menu_name = menuData.find(data =>
                data.id === menuId);
            // console.log(menu_name)


            let categoryId = cartData_user[i]["category_id"];

            // for getting category name from url
            let category_name = categoryData.find(data =>
                data.id === categoryId);
            // console.log(category_name);

            let n = cartData_user[i]["dishData"]


            let finddish = dishData.filter(product =>
                n.some(find => find.id === product.id));
            // console.log(finddish)



            div_cart_content = document.createElement("div");
            div_cart_content.setAttribute("role", "form");
            div_cart_content.setAttribute("class", "cart_content");

            div_cart_text = document.createElement("div");
            div_cart_text.setAttribute("class", "cart_text");
            div_cart_content.append(div_cart_text)

            h3 = document.createElement("h3");
            h3.innerText = category_name["categoryName"] + " " + menu_name["menuName"];
            div_cart_text.append(h3);

            // h2_cart = document.createElement("h2");
            // h2_cart.innerText = cartData_user[i]["menuName"];
            // div_cart_text.append(h2_cart);


            div_change = document.createElement("div");
            div_change.setAttribute("class", "change");
            div_cart_content.append(div_change)

            div_cart_dishes = document.createElement("div");
            div_cart_dishes.setAttribute("class", "cart_dishes");
            div_change.append(div_cart_dishes);

            // h3 = document.createElement("h3");
            // h3.innerText = cartData_user[i]["categoryName"] + " " + cartData_user[i]["menuName"];
            // div_cart_dishes.append(h3);

            span = document.createElement("span");
            span.innerText = "SR's ";
            h3.prepend(span);

            ul_dishes = document.createElement("ul");
            ul_dishes.setAttribute("class", "dishes");
            div_cart_dishes.append(ul_dishes);

            // let a = cartData_user[i]["dishData"]
            // console.log(a)

            for (let j = 0; j < finddish.length; j++) {

                li = document.createElement("li");
                li.innerText = finddish[j]["name"]

                ul_dishes.append(li);

            }

            div_cart_end = document.createElement("div");
            div_cart_end.setAttribute("class", "cart_end");
            div_change.append(div_cart_end);

            div_cart_end_1 = document.createElement("div");
            div_cart_end_1.setAttribute("class", "inside");
            div_cart_end.append(div_cart_end_1);

            label_1 = document.createElement("label");
            label_1.innerText = "Date:";
            div_cart_end_1.append(label_1);

            input_1 = document.createElement("input");
            input_1.setAttribute("type", "date");
            input_1.setAttribute("class", "date");
            input_1.setAttribute("required", "true");
            input_1.setAttribute("value", cartData_user[i]["dateOfDelivery"])
            label_1.append(input_1);

            label_2 = document.createElement("label");
            label_2.innerText = "No.Of.Guest:";
            div_cart_end_1.append(label_2);

            input_2 = document.createElement("input");
            input_2.setAttribute("type", "number");
            input_2.setAttribute("class", "number");
            input_2.setAttribute("required", "true");
            input_2.setAttribute("min", "1")
            input_2.setAttribute("value", cartData_user[i]["noOfGuest"])
            label_2.append(input_2);

            update = document.createElement("button");
            update.setAttribute("type", "button");
            update.setAttribute("class", "btn update");
            update.setAttribute("style", "display:none");
            update.innerText = "Update"
            div_cart_end_1.append(update);

            // img = document.createElement("img");
            // img.setAttribute("src", "../../assets/img/Dishes/ordinary tiffin.jpg");
            // img.setAttribute("alt", "ordinary tiffin");
            // div_cart_end.append(img);

            price = document.createElement("p");
            price.setAttribute("class", "price");

            // let cost = 0
            // for (let k = 0; k < a.length; k++) {
            //     cost += parseInt(a[k]["price"])
            // }
            price.innerText = "₹ " + cartData_user[i]["totalCost"] * cartData_user[i]["noOfGuest"];
            div_cart_end.append(price);


            div_btn_cart = document.createElement("div");
            div_btn_cart.setAttribute("class", "btn_cart");
            div_cart_end.append(div_btn_cart);

            a_1 = document.createElement("a");
            // a_1.setAttribute("href", "../profile/Order page.html?cartId=" + cartData_user[i]["uniqueId"]);
            div_btn_cart.append(a_1);

            button_1 = document.createElement("button");
            button_1.setAttribute("class", "btn order");
            button_1.setAttribute("type", "button");
            button_1.innerText = "ORDER";
            a_1.append(button_1);

            a_2 = document.createElement("a");
            a_2.setAttribute("href", "#");
            div_btn_cart.append(a_2);

            button_2 = document.createElement("button");
            button_2.setAttribute("class", "btn remove");
            button_2.setAttribute("data-id", cartData_user[i]["uniqueId"])
            button_2.setAttribute("type", "button");
            button_2.innerText = "REMOVE";
            a_2.append(button_2);

            ensure = document.createElement("p")
            ensure.setAttribute("class", "ensure");
            ensure.innerText = "Please check the Delivery date and No.of.guest before order"
            div_cart_end.append(ensure)

            document.querySelector("div.cart").append(div_cart_content);

            // summary table
            div_sum_content = document.querySelector(".sum_content")

            div_sum_details = document.createElement("div")
            div_sum_details.setAttribute("class", "sum_details")
            div_sum_content.append(div_sum_details);

            p_name = document.createElement("p");
            p_name.innerText = category_name["categoryName"] + " " + menu_name["menuName"];
            div_sum_details.append(p_name);

            date = document.createElement("p");
            date.innerText = cartData_user[i]["dateOfDelivery"];
            div_sum_details.append(date);

            p_price = document.createElement("p");
            p_price.innerText = "₹ " + cartData_user[i]["totalCost"] * cartData_user[i]["noOfGuest"];
            div_sum_details.append(p_price);

        }


        div_sum_end = document.createElement("div");
        div_sum_end.setAttribute("class", "sum_end");
        div_sum_content.append(div_sum_end);

        p_total = document.createElement("p")
        p_total.innerText = "Total Price";
        div_sum_end.append(p_total);

        let totalcost = 0
        for (let s = 0; s < cartData_user.length; s++) {

            totalcost += cartData_user[s]["totalCost"] * cartData_user[s]["noOfGuest"]
        }

        p_totalprice = document.createElement("p")
        p_totalprice.innerText = "₹ " + totalcost;
        div_sum_end.append(p_totalprice);

        // orderall button
        let div_orderAll = document.querySelector(".cart_orderall");

        let btn_orderall = document.createElement("button");
        btn_orderall.setAttribute("type", "button");
        btn_orderall.setAttribute("class", "btn orderall");
        btn_orderall.innerText = "ORDER ALL" + " " + "(" + cartData_user.length + ")";

        div_orderAll.append(btn_orderall);

        // const checkOrder = e => {
        //     e.preventDefault();

        //     let date = document.getElementById("")
        // }


        // getting extra informatio like no.of.guest and date of delivery
        let updateBtn = document.querySelectorAll(".update")
        updateBtn.forEach(function (upDate) {
            upDate.addEventListener("click", function () {

                let parent = this.closest(".cart_end")
                let getDate = parent.querySelector(".date").value;
                let getNumber = parent.querySelector(".number").value;

                let id = parent.querySelector(".remove").getAttribute("data-id");

                function getId(e) {
                    return e.uniqueId == id
                }
                findcartId = cartData.filter(getId);
                console.log(findcartId)

                // let y = parent.querySelector(".price").innerText.replace("₹", "");
                let y = findcartId[0]["totalCost"]
                // console.log(y);
                let up_totalcost = y * getNumber;
                // console.log(up_totalcost)

                findcartId[0]["dateOfDelivery"] = getDate;
                findcartId[0]["noOfGuest"] = getNumber;
                // findcartId[0]["totalCost"] = up_totalcost;

                localStorage.setItem("cartData", JSON.stringify(cartData));
                location.reload();

            })
        })



        // getting extra information like no.of.guest 
        let number_of_guest = document.querySelectorAll(".number")
        number_of_guest.forEach(function (getGuest) {
            getGuest.addEventListener("click", function () {

                let parent = this.closest(".cart_end")
                update_btn = parent.querySelector(".update")
                update_btn.setAttribute("style", "display:block");

            })
        })


        // getting the date of delivery
        let dateInput = document.querySelectorAll(".date");
        dateInput.forEach(function (getDate) {
            getDate.addEventListener("click", function () {

                let parent = this.closest(".cart_end")
                update_btn = parent.querySelector(".update")
                update_btn.setAttribute("style", "display:block");

            })
        })


        // order button creation
        let orderBtn = document.querySelectorAll(".order");
        orderBtn.forEach(function (orderFood) {
            orderFood.addEventListener("click", function () {

                let before_date = moment().add({ days: 7 }).format("YYYY-MM-DD");

                let parent = this.closest(".cart_end");
                let delivery_date = parent.querySelector(".date").value;
                let unique_id = parent.querySelector(".remove").getAttribute("data-id")

                if (delivery_date <= before_date) {
                    alert("check Date");
                }
                else {
                    location.href = "../profile/Order page.html?cartId=" + unique_id;   
                }
            })
        })


        // orderall button get
        let orderallBtn = document.querySelector(".orderall");
        orderallBtn.addEventListener("click", orderAll);

        function orderAll() {
            let a = true;
            let b = true;

            let before_date = moment().add({ days: 7 }).format("YYYY-MM-DD");

            // let parent = this.closest(".cart_end");
            // let delivery_date = parent.querySelector(".date").value;
            // let unique_id = parent.querySelector(".remove").getAttribute("data-id")

            for (i = 1; i < cartData.length; i++) {

                let delivery_date = cartData[0]["dateOfDelivery"]

                console.log(delivery_date);
                console.log(cartData[i]["dateOfDelivery"]);

                if (delivery_date !== cartData[i]["dateOfDelivery"]) {
                    alert("If you orderall all delivery date should be same")
                    b = false
                }
                console.log(b);

                if (b !== false) {

                    if (delivery_date <= before_date) {
                        alert("check the date of" + " " + " cart.no" + (i + 1));
                        a = false
                    }
                    // console.log(a);

                    if (a !== false) {
                        location.href = "../profile/Order page.html?cartStatus=" + false;
                    }
                }
            }

        }



        // remove from cart
        let removeBtn = document.querySelectorAll(".remove");

        removeBtn.forEach(function (removeCart) {
            removeCart.addEventListener("click", function () {

                const confirmed = confirm("Are you sure, Do you want to remove this menu from the cart?");

                if (confirmed) {

                    let cartid = this.dataset.id;
                    // console.log(cartid);

                    function getIndex(e) {
                        return e.uniqueId == cartid;
                    }

                    let remove_menu = cartData.find(getIndex);

                    let index = cartData.indexOf(remove_menu);

                    cartData.splice(index, 1);
                    localStorage.setItem("cartData", JSON.stringify(cartData))
                    alert("Menu is removed from the Cart")
                    location.reload();

                }
            })
        })


    </script>

    <script src="../../assets/JS/footer.js"></script>

    <!-- script ends -->


</body>

</html>